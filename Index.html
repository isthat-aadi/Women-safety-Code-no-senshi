<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SafeHer - Women Safety Emergency</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700;800;900&amp;family=Space+Mono:wght@400;700&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Lexend', sans-serif; }
    body { background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0d1628 100%); }
    
    @keyframes danger-pulse {
      0%, 100% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.3), inset 0 0 20px rgba(239, 68, 68, 0.1); }
      50% { box-shadow: 0 0 40px rgba(239, 68, 68, 0.6), inset 0 0 30px rgba(239, 68, 68, 0.2); }
    }
    
    @keyframes gps-pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    @keyframes neon-flicker {
      0%, 18%, 22%, 25%, 54%, 56%, 100% { text-shadow: 0 0 10px #ff1744, 0 0 20px #ff1744, 0 0 40px #ff1744; }
      20%, 24%, 55% { text-shadow: none; }
    }
    
    @keyframes float-up {
      0% { transform: translateY(100%); opacity: 0; }
      10% { opacity: 1; }
      100% { transform: translateY(-150vh); opacity: 0; }
    }
    
    @keyframes orbit {
      0% { transform: rotate(0deg) translateX(60px) rotate(0deg); }
      100% { transform: rotate(360deg) translateX(60px) rotate(-360deg); }
    }
    
    .sos-danger { animation: danger-pulse 2s infinite; }
    .gps-ping { animation: gps-pulse 1.5s infinite; }
    .neon-text { animation: neon-flicker 3s infinite; }
    .particle { animation: float-up 3s ease-in forwards; }
    .orbit-item { animation: orbit 20s linear infinite; }
    
    .neural-grid {
      background-image: 
        linear-gradient(rgba(99, 102, 241, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(99, 102, 241, 0.1) 1px, transparent 1px);
      background-size: 50px 50px;
    }
    
    .cyber-border {
      border: 2px solid;
      border-image: linear-gradient(135deg, #ff1744, #ff6e40, #ff1744) 1;
      box-shadow: inset 0 0 20px rgba(255, 23, 68, 0.2), 0 0 20px rgba(255, 23, 68, 0.3);
    }
    
    .hologram {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(236, 72, 153, 0.2));
      backdrop-filter: blur(10px);
      border: 1px solid rgba(99, 102, 241, 0.3);
    }
    
    .slide-up {
      animation: slideUp 0.5s ease-out forwards;
    }
    
    @keyframes slideUp {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(99, 102, 241, 0.05); }
    ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #ff1744, #ff6e40); border-radius: 4px; }
  </style>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full text-white overflow-auto relative neural-grid">
   <!-- Animated Background Particles -->
   <div class="fixed inset-0 pointer-events-none">
    <div class="absolute top-10 left-1/4 w-72 h-72 bg-red-500 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-pulse"></div>
    <div class="absolute top-40 right-1/4 w-72 h-72 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-pulse"></div>
    <div class="absolute -bottom-8 left-1/2 w-72 h-72 bg-cyan-500 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-pulse"></div>
   </div><!-- Main Container -->
   <div class="min-h-full w-full flex flex-col relative z-10">
    <!-- Futuristic Header -->
    <header class="p-6 border-b-2 border-red-500/30 hologram">
     <div class="max-w-6xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-4">
       <div class="relative">
        <div class="absolute inset-0 rounded-lg bg-gradient-to-r from-red-600 to-pink-600 blur-xl opacity-50"></div>
        <div class="relative w-12 h-12 rounded-lg bg-gradient-to-br from-red-500 to-pink-500 flex items-center justify-center">
         <svg class="w-7 h-7 drop-shadow-lg" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M5.5 17a4.5 4.5 0 01-1.44-8.765 4.5 4.5 0 018.752.75c.133.056.26.119.38.187a4.5 4.5 0 01-.88 8.828H5.5z" clip-rule="evenodd" />
         </svg>
        </div>
       </div>
       <div>
        <h1 id="app-title" class="text-2xl font-black bg-gradient-to-r from-red-400 via-pink-400 to-orange-400 bg-clip-text text-transparent tracking-wider">SAFEHER</h1>
        <p class="text-xs text-cyan-400 tracking-widest font-mono">‚ö° SECURITY SYSTEM ACTIVE</p>
       </div>
      </div>
      <div id="location-status" class="flex items-center gap-2 px-4 py-2 rounded-lg cyber-border text-xs font-mono">
       <span class="w-2.5 h-2.5 rounded-full bg-green-400 gps-ping"></span> <span class="text-green-400">GPS ONLINE</span>
      </div>
     </div>
    </header><!-- Main Content Grid -->
    <main class="flex-1 p-6 overflow-auto">
     <div class="max-w-6xl mx-auto">
      <!-- Hero SOS Section -->
      <section class="mb-8">
       <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-stretch">
        <!-- Main SOS Emergency Button -->
        <div class="lg:col-span-2 hologram rounded-3xl p-8 flex flex-col items-center justify-center min-h-96 cyber-border relative overflow-hidden group cursor-pointer">
         <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-red-500 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
         <div class="relative z-10 text-center">
          <p class="text-red-400 text-sm font-mono tracking-widest mb-6 uppercase">Emergency Alert System</p><button id="sos-btn" class="relative w-48 h-48 mb-6 group mx-auto"> <!-- Outer rings -->
           <div class="absolute inset-0 rounded-full border-2 border-red-500/30 sos-danger"></div>
           <div class="absolute inset-8 rounded-full border-2 border-red-500/60 sos-danger" style="animation-delay: 0.3s;"></div>
           <div class="absolute inset-16 rounded-full border-2 border-red-500/80 sos-danger" style="animation-delay: 0.6s;"></div><!-- Main button -->
           <div class="absolute inset-0 rounded-full bg-gradient-to-br from-red-600 via-red-700 to-red-800 shadow-2xl shadow-red-600/50 flex flex-col items-center justify-center group-hover:shadow-red-500/80 transition-all duration-300 cursor-pointer">
            <svg class="w-16 h-16 mb-2 drop-shadow-lg" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z" />
            </svg><span id="sos-text" class="text-2xl font-black text-white drop-shadow-lg tracking-widest">TAP FOR HELP</span>
           </div></button>
          <p class="text-gray-400 text-xs font-mono">Press and send SOS to emergency contacts with your live location</p>
         </div>
        </div><!-- Right Side Stats -->
        <div class="flex flex-col gap-6">
         <!-- GPS Location Live -->
         <div class="hologram rounded-2xl p-6 cyber-border h-44 flex flex-col justify-between group hover:shadow-lg hover:shadow-red-500/20 transition-all">
          <div>
           <p class="text-red-400 text-xs font-mono tracking-widest uppercase mb-2">üì° Live Location</p>
           <div class="relative w-12 h-12 mb-3">
            <div class="absolute inset-0 rounded-full bg-red-500/30 gps-ping"></div>
            <div class="relative w-12 h-12 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-lg font-bold">
             üìç
            </div>
           </div>
          </div>
          <div>
           <p id="current-address" class="text-white text-xs font-mono leading-tight mb-2">Fetching live location...</p>
           <p class="text-gray-500 text-xs font-mono"><span id="lat-display">Lat: --</span> | <span id="lng-display">Lng: --</span></p>
          </div>
         </div><!-- Status Panel -->
         <div class="hologram rounded-2xl p-4 cyber-border">
          <div class="space-y-3">
           <div class="flex items-center justify-between text-xs">
            <span class="text-gray-400 font-mono">STATUS</span> <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full font-mono">READY</span>
           </div>
           <div class="flex items-center justify-between text-xs">
            <span class="text-gray-400 font-mono">GPS SIGNAL</span> <span class="text-cyan-400 font-mono">STRONG</span>
           </div>
           <div class="flex items-center justify-between text-xs">
            <span class="text-gray-400 font-mono">ENCRYPTION</span> <span class="text-green-400 font-mono">‚úì ACTIVE</span>
           </div>
          </div>
         </div>
        </div>
       </div>
      </section><!-- Quick Actions - Futuristic Grid -->
      <section class="mb-8">
       <h2 class="text-sm font-mono tracking-widest text-red-400 uppercase mb-6">‚öîÔ∏è Emergency Tools</h2>
       <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- Live Location Action --> <button id="location-btn" class="hologram rounded-2xl p-6 cyber-border group hover:shadow-cyan-500/50 hover:shadow-lg transition-all duration-300 cursor-pointer h-40 flex flex-col items-center justify-center relative overflow-hidden">
         <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
         <div class="relative z-10 text-center">
          <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-cyan-500/20 to-blue-600/20 flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
           <svg class="w-7 h-7 text-cyan-400" fill="currentColor" viewbox="0 0 24 24"><path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
           </svg>
          </div>
          <p class="font-bold text-white text-sm mb-1">LIVE LOCATION</p>
          <p class="text-xs text-gray-400">Stream &amp; Share</p>
         </div></button> <!-- Fake Call Action --> <button id="fakecall-btn" class="hologram rounded-2xl p-6 cyber-border group hover:shadow-green-500/50 hover:shadow-lg transition-all duration-300 cursor-pointer h-40 flex flex-col items-center justify-center relative overflow-hidden">
         <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-green-500 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
         <div class="relative z-10 text-center">
          <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-green-500/20 to-emerald-600/20 flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
           <svg class="w-7 h-7 text-green-400" fill="currentColor" viewbox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z" />
           </svg>
          </div>
          <p class="font-bold text-white text-sm mb-1">FAKE CALL</p>
          <p class="text-xs text-gray-400">Escape Safely</p>
         </div></button> <!-- Record Evidence Action --> <button id="record-btn" class="hologram rounded-2xl p-6 cyber-border group hover:shadow-purple-500/50 hover:shadow-lg transition-all duration-300 cursor-pointer h-40 flex flex-col items-center justify-center relative overflow-hidden">
         <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-purple-500 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
         <div class="relative z-10 text-center">
          <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500/20 to-violet-600/20 flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
           <svg class="w-7 h-7 text-purple-400" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
           </svg>
          </div>
          <p class="font-bold text-white text-sm mb-1">RECORD EVIDENCE</p>
          <p class="text-xs text-gray-400">Audio &amp; Video Proof</p>
         </div></button> <!-- Location History Action --> <button id="history-btn" class="hologram rounded-2xl p-6 cyber-border group hover:shadow-orange-500/50 hover:shadow-lg transition-all duration-300 cursor-pointer h-40 flex flex-col items-center justify-center relative overflow-hidden">
         <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-orange-500 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
         <div class="relative z-10 text-center">
          <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-orange-500/20 to-amber-600/20 flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
           <svg class="w-7 h-7 text-orange-400" fill="currentColor" viewbox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5-7h-3v3H9v-3H6v-2h3V6h2v3h3v2z" />
           </svg>
          </div>
          <p class="font-bold text-white text-sm mb-1">LOCATION HISTORY</p>
          <p class="text-xs text-gray-400">View Timeline</p>
         </div></button>
       </div>
      </section><!-- Emergency Contacts Panel -->
      <section class="mb-8">
       <h2 class="text-sm font-mono tracking-widest text-red-400 uppercase mb-4">üîå Emergency Contacts</h2>
       <div class="hologram rounded-2xl p-6 cyber-border">
        <div class="grid grid-cols-2 gap-4">
         <div class="bg-gradient-to-br from-blue-500/10 to-cyan-500/10 rounded-xl p-4 border border-blue-500/20 hover:border-blue-500/50 transition-colors">
          <p class="text-xs text-gray-400 font-mono mb-2">PRIMARY CONTACT</p>
          <div class="flex items-center gap-3">
           <div class="w-10 h-10 rounded-lg bg-blue-500/30 flex items-center justify-center text-lg">
            üë®
           </div>
           <div>
            <p id="contact-1-name" class="font-bold text-sm">Papa</p>
            <p class="text-xs text-gray-500">READY</p>
           </div>
          </div>
         </div>
         <div class="bg-gradient-to-br from-pink-500/10 to-red-500/10 rounded-xl p-4 border border-pink-500/20 hover:border-pink-500/50 transition-colors">
          <p class="text-xs text-gray-400 font-mono mb-2">SECONDARY CONTACT</p>
          <div class="flex items-center gap-3">
           <div class="w-10 h-10 rounded-lg bg-pink-500/30 flex items-center justify-center text-lg">
            üë©
           </div>
           <div>
            <p id="contact-2-name" class="font-bold text-sm">Mummy</p>
            <p class="text-xs text-gray-500">READY</p>
           </div>
          </div>
         </div>
        </div>
       </div>
      </section>
     </div>
    </main><!-- Footer -->
    <footer class="p-4 border-t border-red-500/20 hologram text-center text-xs text-gray-500 font-mono">
     <p>üîê ENCRYPTED | üõ°Ô∏è SECURE | ‚ö° REAL-TIME</p>
    </footer>
   </div><!-- Fake Call Modal -->
   <div id="fakecall-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
    <div class="relative h-full flex flex-col items-center justify-center p-6 slide-up">
     <div class="hologram rounded-3xl p-6 w-full max-w-sm cyber-border">
      <h3 class="text-center text-lg font-semibold mb-6">Choose Caller</h3>
      <div class="flex flex-col gap-4">
       <button id="call-papa" class="flex items-center gap-4 p-4 bg-white/5 rounded-2xl hover:bg-white/10 transition-all cursor-pointer">
        <div class="w-14 h-14 rounded-full bg-blue-500/30 flex items-center justify-center text-2xl">
         üë®
        </div>
        <div class="text-left">
         <p id="caller-papa-name" class="font-semibold">Papa</p>
         <p class="text-sm text-gray-400">Incoming call</p>
        </div>
        <svg class="w-8 h-8 ml-auto text-green-400" fill="currentColor" viewbox="0 0 24 24"><path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z" />
        </svg></button> <button id="call-mummy" class="flex items-center gap-4 p-4 bg-white/5 rounded-2xl hover:bg-white/10 transition-all cursor-pointer">
        <div class="w-14 h-14 rounded-full bg-pink-500/30 flex items-center justify-center text-2xl">
         üë©
        </div>
        <div class="text-left">
         <p id="caller-mummy-name" class="font-semibold">Mummy</p>
         <p class="text-sm text-gray-400">Incoming call</p>
        </div>
        <svg class="w-8 h-8 ml-auto text-green-400" fill="currentColor" viewbox="0 0 24 24"><path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z" />
        </svg></button>
      </div><button id="close-fakecall-modal" class="mt-6 w-full py-3 text-gray-400 hover:text-white transition-colors cursor-pointer">Cancel</button>
     </div>
    </div>
   </div><!-- Incoming Call Screen -->
   <div id="call-screen" class="fixed inset-0 z-50 hidden" style="background: linear-gradient(180deg, #1e3a5f 0%, #0d1b2a 100%);">
    <div class="h-full flex flex-col items-center justify-between py-12 px-6">
     <div class="text-center">
      <p class="text-gray-400 text-sm mb-2">Incoming call</p>
      <div id="caller-avatar" class="w-28 h-28 rounded-full bg-blue-500/30 flex items-center justify-center text-5xl mx-auto mb-4" style="animation: gps-pulse 1.5s infinite;">
       üë®
      </div>
      <h2 id="caller-name-display" class="text-3xl font-bold mb-1">Papa</h2>
      <p class="text-gray-400">Mobile</p>
     </div>
     <div id="call-status" class="text-center">
      <p class="text-lg text-gray-300">Calling...</p>
      <p id="call-timer" class="text-4xl font-light text-white mt-2">00:00</p>
     </div>
     <div class="flex gap-8">
      <button id="decline-call" class="w-16 h-16 rounded-full bg-red-500 flex items-center justify-center hover:bg-red-600 transition-colors cursor-pointer">
       <svg class="w-8 h-8 rotate-[135deg]" fill="currentColor" viewbox="0 0 24 24"><path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z" />
       </svg></button> <button id="accept-call" class="w-16 h-16 rounded-full bg-green-500 flex items-center justify-center hover:bg-green-600 transition-colors cursor-pointer">
       <svg class="w-8 h-8" fill="currentColor" viewbox="0 0 24 24"><path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z" />
       </svg></button>
     </div>
    </div>
   </div><!-- Record Modal -->
   <div id="record-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
    <div class="relative h-full flex flex-col items-center justify-center p-6">
     <div class="hologram rounded-3xl p-6 w-full max-w-sm cyber-border slide-up">
      <h3 class="text-center text-lg font-semibold mb-2">Record Evidence</h3>
      <p class="text-center text-sm text-gray-400 mb-6">Audio &amp; video will be saved as proof</p>
      <div id="recording-status" class="hidden mb-6">
       <div class="flex items-center justify-center gap-2 mb-4">
        <span class="w-3 h-3 rounded-full bg-red-500" style="animation: recording-pulse 1s ease-in-out infinite;"></span> <span class="text-red-400 font-medium">Recording</span>
       </div>
       <div id="recording-timer" class="text-4xl font-light text-center">
        00:00
       </div>
      </div>
      <div id="video-preview" class="hidden mb-4 rounded-xl overflow-hidden bg-black aspect-video">
       <video id="preview-video" autoplay muted playsinline class="w-full h-full object-cover"></video>
      </div>
      <div class="flex flex-col gap-3">
       <button id="start-audio-record" class="flex items-center justify-center gap-3 p-4 bg-purple-500/20 rounded-xl hover:bg-purple-500/30 transition-all cursor-pointer">
        <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
        </svg><span class="font-medium">Record Audio</span> </button> <button id="start-video-record" class="flex items-center justify-center gap-3 p-4 bg-violet-500/20 rounded-xl hover:bg-violet-500/30 transition-all cursor-pointer">
        <svg class="w-6 h-6 text-violet-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
        </svg><span class="font-medium">Record Video</span> </button> <button id="stop-record" class="hidden flex items-center justify-center gap-3 p-4 bg-red-500/20 rounded-xl hover:bg-red-500/30 transition-all cursor-pointer">
        <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" />
        </svg><span class="font-medium">Stop &amp; Save</span> </button>
      </div><button id="close-record-modal" class="mt-6 w-full py-3 text-gray-400 hover:text-white transition-colors cursor-pointer">Close</button>
     </div>
    </div>
   </div><!-- Location History Modal -->
   <div id="history-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
    <div class="relative h-full flex flex-col p-6 overflow-auto">
     <div class="hologram rounded-3xl p-6 w-full max-w-lg mx-auto cyber-border slide-up">
      <div class="flex items-center justify-between mb-6">
       <h3 class="text-lg font-semibold">üìç Location History</h3><button id="close-history-modal" class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 cursor-pointer">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg></button>
      </div>
      <div id="history-list" class="flex flex-col gap-3 max-h-96 overflow-auto">
       <p class="text-gray-400 text-sm text-center py-8">No location history yet</p>
      </div><button id="clear-history" class="mt-4 w-full py-3 bg-red-500/20 text-red-400 rounded-xl hover:bg-red-500/30 transition-colors cursor-pointer">Clear All History</button>
     </div>
    </div>
   </div><!-- Location Sent Toast -->
   <div id="toast" class="fixed top-4 left-1/2 -translate-x-1/2 z-50 hidden">
    <div class="hologram rounded-full px-6 py-3 flex items-center gap-3 slide-up cyber-border">
     <span class="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg></span> <span id="toast-message" class="font-medium text-sm">Location sent to contacts!</span>
    </div>
   </div>
   <style>
      @keyframes recording-pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }
    </style>
  </div>
  <script>
    // Default Configuration
    const defaultConfig = {
      app_title: 'SAFEHER',
      sos_text: 'TAP FOR HELP',
      emergency_contact_1: 'Papa',
      emergency_contact_2: 'Mummy'
    };

    // App State
    let currentLocation = { lat: null, lng: null, address: 'Unknown', city: '', country: '' };
    let locationHistory = [];
    let mediaRecorder = null;
    let recordedChunks = [];
    let recordingTimer = null;
    let recordingSeconds = 0;
    let callTimer = null;
    let callSeconds = 0;
    let mediaStream = null;
    let locationUpdateInterval = null;

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
          document.getElementById('sos-text').textContent = config.sos_text || defaultConfig.sos_text;
          
          const contact1 = config.emergency_contact_1 || defaultConfig.emergency_contact_1;
          const contact2 = config.emergency_contact_2 || defaultConfig.emergency_contact_2;
          
          document.getElementById('contact-1-name').textContent = contact1;
          document.getElementById('contact-2-name').textContent = contact2;
          document.getElementById('caller-papa-name').textContent = contact1;
          document.getElementById('caller-mummy-name').textContent = contact2;
        },
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ['app_title', config.app_title || defaultConfig.app_title],
          ['sos_text', config.sos_text || defaultConfig.sos_text],
          ['emergency_contact_1', config.emergency_contact_1 || defaultConfig.emergency_contact_1],
          ['emergency_contact_2', config.emergency_contact_2 || defaultConfig.emergency_contact_2]
        ])
      });
    }

    // Data SDK Handler
    const dataHandler = {
      onDataChanged(data) {
        locationHistory = data.filter(d => d.type === 'location');
        updateHistoryUI();
      }
    };

    // Initialize Data SDK
    async function initDataSdk() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize data SDK');
        }
      }
    }
    initDataSdk();

    // Geolocation with reverse geocoding
    async function getCurrentLocation() {
      return new Promise((resolve, reject) => {
        if (!navigator.geolocation) {
          reject(new Error('Geolocation not supported'));
          return;
        }
        
        navigator.geolocation.getCurrentPosition(
          async (position) => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            
            let address = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
            let city = '';
            let country = '';
            
            try {
              const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
              const data = await response.json();
              if (data.display_name) {
                address = data.display_name;
              }
              if (data.address) {
                city = data.address.city || data.address.town || data.address.village || '';
                country = data.address.country || '';
              }
            } catch (e) {
              console.error('Geocoding failed:', e);
            }
            
            resolve({ lat, lng, address, city, country });
          },
          (error) => {
            reject(error);
          },
          { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
        );
      });
    }

    // Update location display continuously
    async function updateLocationDisplay() {
      try {
        const location = await getCurrentLocation();
        currentLocation = location;
        
        document.getElementById('current-address').textContent = location.address.substring(0, 120) + (location.address.length > 120 ? '...' : '');
        document.getElementById('lat-display').textContent = `Lat: ${location.lat.toFixed(6)}`;
        document.getElementById('lng-display').textContent = `Lng: ${location.lng.toFixed(6)}`;
        
        document.getElementById('location-status').innerHTML = `
          <span class="w-2.5 h-2.5 rounded-full bg-green-400 gps-ping"></span>
          <span class="text-green-400">GPS ONLINE</span>
        `;
        
      } catch (error) {
        document.getElementById('current-address').textContent = 'Location access denied or unavailable';
        document.getElementById('location-status').innerHTML = `
          <span class="w-2.5 h-2.5 rounded-full bg-red-400"></span>
          <span class="text-red-400">GPS ERROR</span>
        `;
      }
    }

    // Save location to history
    async function saveLocationToHistory(type = 'manual') {
      if (!currentLocation.lat || locationHistory.length >= 999) {
        if (locationHistory.length >= 999) {
          showToast('Maximum history limit reached!', 'warning');
        }
        return;
      }
      
      if (window.dataSdk) {
        const result = await window.dataSdk.create({
          type: 'location',
          timestamp: new Date().toISOString(),
          latitude: currentLocation.lat,
          longitude: currentLocation.lng,
          address: currentLocation.address,
          city: currentLocation.city,
          country: currentLocation.country,
          recording_duration: 0,
          status: type
        });
        
        if (!result.isOk) {
          console.error('Failed to save location');
        }
      }
    }

    // Update history UI
    function updateHistoryUI() {
      const historyList = document.getElementById('history-list');
      
      if (locationHistory.length === 0) {
        historyList.innerHTML = '<p class="text-gray-400 text-sm text-center py-8">No location history yet</p>';
        return;
      }
      
      const sortedHistory = [...locationHistory].sort((a, b) => 
        new Date(b.timestamp) - new Date(a.timestamp)
      );
      
      historyList.innerHTML = sortedHistory.map((item) => {
        const date = new Date(item.timestamp);
        const statusColors = {
          'sos': 'bg-red-500/20 text-red-400',
          'manual': 'bg-blue-500/20 text-blue-400',
          'recording': 'bg-purple-500/20 text-purple-400'
        };
        const statusLabels = {
          'sos': 'üÜò SOS ALERT',
          'manual': 'üìç LOCATION SHARED',
          'recording': 'üé• RECORDING'
        };
        
        return `
          <div class="bg-white/5 rounded-xl p-4 border border-gray-700/50">
            <div class="flex items-start justify-between mb-2">
              <span class="px-2 py-1 rounded-full text-xs font-mono ${statusColors[item.status] || 'bg-gray-500/20 text-gray-400'}">${statusLabels[item.status] || item.status}</span>
              <span class="text-xs text-gray-500 font-mono">${date.toLocaleString()}</span>
            </div>
            <p class="text-sm text-white mb-2 font-mono">${(item.address || 'Unknown location').substring(0, 80)}...</p>
            <div class="flex gap-2 text-xs text-gray-400 mb-2">
              <span class="font-mono">Lat: ${item.latitude?.toFixed(4) || '--'}</span>
              <span class="font-mono">Lng: ${item.longitude?.toFixed(4) || '--'}</span>
            </div>
            <a href="https://www.google.com/maps?q=${item.latitude},${item.longitude}" target="_blank" rel="noopener noreferrer" class="inline-block text-xs text-cyan-400 hover:text-cyan-300 font-mono">View on Google Maps ‚Üí</a>
          </div>
        `;
      }).join('');
    }

    // Show toast notification
    function showToast(message) {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      toastMessage.textContent = message;
      toast.classList.remove('hidden');
      
      setTimeout(() => {
        toast.classList.add('hidden');
      }, 3000);
    }

    // SOS Button Handler - Auto-records video and audio
    document.getElementById('sos-btn').addEventListener('click', async () => {
      await updateLocationDisplay();
      await saveLocationToHistory('sos');
      
      const config = window.elementSdk?.config || defaultConfig;
      const contact1 = config.emergency_contact_1 || defaultConfig.emergency_contact_1;
      const contact2 = config.emergency_contact_2 || defaultConfig.emergency_contact_2;
      
      showToast(`üÜò EMERGENCY ALERT SENT TO ${contact1} & ${contact2} WITH LIVE LOCATION!`);
      
      // Auto-start video and audio recording
      try {
        mediaStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        startRecording(mediaStream, 'video');
        showToast('üé• EMERGENCY RECORDING STARTED - VIDEO & AUDIO ACTIVE');
      } catch (error) {
        console.error('Failed to start automatic recording:', error);
        showToast('‚ö†Ô∏è Unable to access camera - audio only will be recorded');
        try {
          mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
          startRecording(mediaStream, 'audio');
          showToast('üéôÔ∏è EMERGENCY RECORDING STARTED - AUDIO ACTIVE');
        } catch (audioError) {
          showToast('‚ö†Ô∏è Unable to access camera and microphone');
        }
      }
    });

    // Live Location Button
    document.getElementById('location-btn').addEventListener('click', async () => {
      await updateLocationDisplay();
      await saveLocationToHistory('manual');
      showToast('üìç LIVE LOCATION STREAMED TO CONTACTS!');
    });

    // Fake Call Modal
    document.getElementById('fakecall-btn').addEventListener('click', () => {
      document.getElementById('fakecall-modal').classList.remove('hidden');
    });

    document.getElementById('close-fakecall-modal').addEventListener('click', () => {
      document.getElementById('fakecall-modal').classList.add('hidden');
    });

    document.getElementById('call-papa').addEventListener('click', () => {
      const config = window.elementSdk?.config || defaultConfig;
      startFakeCall(config.emergency_contact_1 || defaultConfig.emergency_contact_1, 'üë®', 'bg-blue-500/30');
    });

    document.getElementById('call-mummy').addEventListener('click', () => {
      const config = window.elementSdk?.config || defaultConfig;
      startFakeCall(config.emergency_contact_2 || defaultConfig.emergency_contact_2, 'üë©', 'bg-pink-500/30');
    });

    function startFakeCall(name, emoji, bgClass) {
      document.getElementById('fakecall-modal').classList.add('hidden');
      document.getElementById('call-screen').classList.remove('hidden');
      document.getElementById('caller-name-display').textContent = name;
      document.getElementById('caller-avatar').textContent = emoji;
      document.getElementById('caller-avatar').className = `w-28 h-28 rounded-full ${bgClass} flex items-center justify-center text-5xl mx-auto mb-4 gps-ping`;
      callSeconds = 0;
    }

    document.getElementById('accept-call').addEventListener('click', () => {
      document.getElementById('call-status').innerHTML = `<p class="text-lg text-green-400">Connected</p><p id="call-timer" class="text-4xl font-light text-white mt-2">00:00</p>`;
      
      callTimer = setInterval(() => {
        callSeconds++;
        const mins = Math.floor(callSeconds / 60).toString().padStart(2, '0');
        const secs = (callSeconds % 60).toString().padStart(2, '0');
        document.getElementById('call-timer').textContent = `${mins}:${secs}`;
      }, 1000);
    });

    document.getElementById('decline-call').addEventListener('click', () => {
      endCall();
    });

    function endCall() {
      document.getElementById('call-screen').classList.add('hidden');
      if (callTimer) {
        clearInterval(callTimer);
        callTimer = null;
      }
      callSeconds = 0;
    }

    // Record Modal
    document.getElementById('record-btn').addEventListener('click', () => {
      document.getElementById('record-modal').classList.remove('hidden');
    });

    document.getElementById('close-record-modal').addEventListener('click', () => {
      stopRecording();
      document.getElementById('record-modal').classList.add('hidden');
    });

    document.getElementById('start-audio-record').addEventListener('click', async () => {
      try {
        mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
        startRecording(mediaStream, 'audio');
      } catch (error) {
        showToast('Unable to access microphone!');
      }
    });

    document.getElementById('start-video-record').addEventListener('click', async () => {
      try {
        mediaStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        document.getElementById('video-preview').classList.remove('hidden');
        document.getElementById('preview-video').srcObject = mediaStream;
        startRecording(mediaStream, 'video');
      } catch (error) {
        showToast('Unable to access camera!');
      }
    });

    function startRecording(stream, type) {
      recordedChunks = [];
      mediaRecorder = new MediaRecorder(stream);
      
      mediaRecorder.ondataavailable = (e) => {
        if (e.data.size > 0) {
          recordedChunks.push(e.data);
        }
      };
      
      mediaRecorder.onstop = async () => {
        const blob = new Blob(recordedChunks, { type: type === 'video' ? 'video/webm' : 'audio/webm' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `evidence_${Date.now()}.webm`;
        a.click();
        
        await saveLocationToHistory('recording');
        showToast(`üé• ${type === 'video' ? 'VIDEO' : 'AUDIO'} EVIDENCE SAVED & STORED!`);
      };
      
      mediaRecorder.start();
      recordingSeconds = 0;
      
      document.getElementById('recording-status').classList.remove('hidden');
      document.getElementById('start-audio-record').classList.add('hidden');
      document.getElementById('start-video-record').classList.add('hidden');
      document.getElementById('stop-record').classList.remove('hidden');
      document.getElementById('stop-record').classList.add('flex');
      
      recordingTimer = setInterval(() => {
        recordingSeconds++;
        const mins = Math.floor(recordingSeconds / 60).toString().padStart(2, '0');
        const secs = (recordingSeconds % 60).toString().padStart(2, '0');
        document.getElementById('recording-timer').textContent = `${mins}:${secs}`;
      }, 1000);
    }

    document.getElementById('stop-record').addEventListener('click', () => {
      stopRecording();
    });

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
      }
      
      if (mediaStream) {
        mediaStream.getTracks().forEach(track => track.stop());
        mediaStream = null;
      }
      
      if (recordingTimer) {
        clearInterval(recordingTimer);
        recordingTimer = null;
      }
      
      document.getElementById('recording-status').classList.add('hidden');
      document.getElementById('video-preview').classList.add('hidden');
      document.getElementById('start-audio-record').classList.remove('hidden');
      document.getElementById('start-video-record').classList.remove('hidden');
      document.getElementById('stop-record').classList.add('hidden');
      document.getElementById('stop-record').classList.remove('flex');
    }

    // History Modal
    document.getElementById('history-btn').addEventListener('click', () => {
      document.getElementById('history-modal').classList.remove('hidden');
    });

    document.getElementById('close-history-modal').addEventListener('click', () => {
      document.getElementById('history-modal').classList.add('hidden');
    });

    document.getElementById('clear-history').addEventListener('click', async () => {
      if (window.dataSdk && locationHistory.length > 0) {
        for (const item of locationHistory) {
          await window.dataSdk.delete(item);
        }
        showToast('‚úì HISTORY CLEARED!');
      }
    });

    // Initialize and start continuous location updates
    updateLocationDisplay();
    locationUpdateInterval = setInterval(updateLocationDisplay, 5000);
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d10b1bdf43e9aa5',t:'MTc3MTYxODcxOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
